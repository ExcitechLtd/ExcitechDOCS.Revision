<?xml version="1.0" encoding="utf-8"?>
<!--
    # This comment is generated by WixEdit, the specific commandline
    # arguments for the WiX Toolset are stored here.

    candleArgs: 
    lightArgs: "<projectname>.wixobj" -out "<projectname>.msi" -ext "C:\Program Files (x86)\WiX Toolset v3.11\bin\WixNetFxExtension.dll"  -ext "C:\Program Files (x86)\WiX Toolset v3.11\bin\WixUIExtension.dll"
-->
<?define VersionFull = 1.0.0.0 ?>
<?define VersionShort = 1.0 ?>
<?define VersionDescription = ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="*" Name="ExcitechDOCS Document Revision" Language="1033" Version="$(var.VersionFull)" Manufacturer="Excitech" UpgradeCode="d7855b45-d059-4626-a7fa-61b6c712030e">
        <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" Comments="Version: $(var.VersionFull) $(var.VersionDescription)" />
        <!--Check .NET 4.6 Framework installed-->
        <PropertyRef Id="WIX_IS_NETFRAMEWORK_46_OR_LATER_INSTALLED" />
        <Condition Message="This application requires .NET Framework 4.6. Please install the .NET Framework then run this installer again."><![CDATA[Installed OR WIX_IS_NETFRAMEWORK_46_OR_LATER_INSTALLED]]></Condition>
        <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." AllowSameVersionUpgrades="no" Schedule="afterInstallInitialize" />
        <MediaTemplate EmbedCab="yes" />
        <UI />
        <WixVariable Id="WixUIBannerBmp" Value="Images\Installer_Top_Banner.bmp" />
        <WixVariable Id="WixUIDialogBmp" Value="Images\Installer_Background.bmp" />
        <WixVariable Id="WixUILicenseRtf" Value="InstallFiles\LicenseRTF\license-agreement.rtf" />
        <Binary Id="ExcitechIcon" SourceFile="Images\Excitech.ico" />
        <Binary Id="WixCustomSetupActions.CA.dll" SourceFile="..\WixCustomSetupActions\bin\$(var.Configuration)\WixCustomSetupActions.CA.dll" />
        <UIRef Id="WixUI_FeatureTree" />
        <Icon Id="Help.ico" SourceFile="Images\Help.ico" />
        <Feature Id="featureDocRevision" Description="Server Document Revision Application" Title="Document Revision History" Level="1">
            <ComponentRef Id="compServerapp" />
        </Feature>
        <Feature Id="featureDocumentation" Description="Document Revision History HelpFile" Level="1" Title="Documentation">
            <ComponentRef Id="compHelpfile" />
        </Feature>
        <Feature Id="featureRevitModules" Description="Document Revision Modules for Revit Add-In" Level="1" Title="Revit Modules">
            <ComponentRef Id="compRevit" />
        </Feature>
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFilesFolder">
                <Directory Id="INSTALLFOLDER" Name="Excitech DOCS">
                    <Directory Id="dirDocRevision" Name="Document Revision">
                        <Directory Id="dirServer" Name="Server">
                            <Component Guid="6A8D6310-F311-43BA-9771-36DB7F577996" Id="compServerapp">
                                <File Id="fileAppInstaller" Name="ExcitechDOCS.Application.Installer.exe" Source="InstallFiles\ServerApplication\ExcitechDOCS.Application.Installer.exe" />
                                <File Id="fileServerApp" Name="ExDOCS_Revision_History.mfappx" Source="InstallFiles\ServerApplication\ExDOCS_Revision_History.mfappx" />
                                <RemoveFolder Id="dirServer" On="uninstall" />
                            </Component>
                        </Directory>
                        <Directory Id="dirRevit" Name="Revit">
                            <Component Guid="2988D3EC-2498-45E8-A600-339BACB75445" Id="compRevit">
                                <File Id="fileRevit.ExcitechDOCS.Revision" Name="ExcitechDOCS.Revision.dll" Source="InstallFiles\Revit Modules\ExcitechDOCS.Revision.dll" />
                                <File Id="INTEROP.MFILESAPI.DLL" Name="Interop.MFilesAPI.dll" Source="InstallFiles\Revit Modules\Interop.MFilesAPI.dll" />
                                <File Id="MFILES.CRYPTO.DLL" Name="MFiles.Crypto.dll" Source="InstallFiles\Revit Modules\MFiles.Crypto.dll" />
                                <File Id="MFILES.VAF.CONFIGURATION.DLL" Name="MFiles.VAF.Configuration.dll" Source="InstallFiles\Revit Modules\MFiles.VAF.Configuration.dll" />
                                <File Id="MFILES.VAF.DLL" Name="MFiles.VAF.dll" Source="InstallFiles\Revit Modules\MFiles.VAF.dll" />
                                <File Id="NEWTONSOFT.JSON.DLL" Name="Newtonsoft.Json.dll" Source="InstallFiles\Revit Modules\Newtonsoft.Json.dll" />
                                <File Id="SYSTEM.NET.HTTP.DLL" Name="System.Net.Http.dll" Source="InstallFiles\Revit Modules\System.Net.Http.dll" />
                            </Component>
                        </Directory>
                        <Directory Id="dirDocumentation" Name="Documentation">
                            <Component Guid="2809D752-03B2-4B7A-85B5-B360FE262879" Id="compHelpfile">
                                <File Checksum="yes" Id="fileHelpFile" Name="ExcitechDOCS Document Revision.chm" Source="InstallFiles\Helpfile\ExcitechDOCS Document Revision.chm">
                                    <Shortcut Id="shortcutDocumentation" Name="Document Revision History Help" Advertise="yes" Directory="ProgramMenuDir" Icon="Help.ico" />
                                </File>
                                <RemoveFolder Id="removeDocumentationFolder" On="uninstall" Directory="ProgramMenuDir" />
                            </Component>
                        </Directory>
                    </Directory>
                </Directory>
            </Directory>
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ProgramMenuDir" Name="Excitech DOCS" />
            </Directory>
        </Directory>
        <InstallExecuteSequence>
            <Custom Action="actionInstall" After="InstallFinalize">NOT Installed AND NOT Remove</Custom>
            <Custom Action="actionUninstall" Before="InstallFinalize">Installed</Custom>
        </InstallExecuteSequence>
        <CustomAction Id="actionInstall" BinaryKey="WixCustomSetupActions.CA.dll" DllEntry="InstallDocumentRevision" Impersonate="yes" Execute="immediate" />
        <CustomAction Id="actionUninstall" BinaryKey="WixCustomSetupActions.CA.dll" DllEntry="UnInstallDocumentRevision" Impersonate="yes" />
    </Product>
</Wix>