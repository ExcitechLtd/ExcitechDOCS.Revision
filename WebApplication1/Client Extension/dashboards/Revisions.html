<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="../css/datatables.css" />
    <link rel="stylesheet" type="text/css" href="../css/ExtranetLog.css" />
    <script src="../scripts/datatables.min.js"></script>
    <script src="../scripts/Moment.js"></script>
    <script src="../scripts/DocumentLog.js"></script>
    <script src="../scripts/ExtranetLog.js"></script>
    <script src="../scripts/Utilities.js"></script>
</head>
<body oncontextmenu="return false;">
    <!--Header-->
    <div style="color:#676767;background-color: #f2f2f2; height: 130px;font-family: Segoe UI, Tahoma, Arial, sans-serif;">
        <img style='padding:18px 0 0 15px; width: 48px;' src='../images/CloudUpload_64.png' />
        <div style='position: absolute; top: 26px;  left: 78px; right:5px; font-size: 24px;text-overflow: ellipsis;white-space: nowrap;overflow: hidden'>Extranet Log</div>
        <div id='objectHeading' style='position: absolute; top: 55px; left: 78px; right:5px; font-size: 16px; font-weight: bold;text-overflow: ellipsis;white-space: nowrap;overflow: hidden'>Document Name</div>
        <div style='color:#808080;position: absolute; top: 90.5px; left: 13px; font-size: 14px;'>Document</div>
        <div id='versionInfo' style='color:#808080;position: absolute; top: 109px; left: 13px; font-size: 14px;'>ID 0 Version 0</div>
    </div>
    <!--Search and tool bar-->
    <div style="background-color: #3db7e4;height: 32px;overflow:hidden;">
        <input style='margin: 8px;width: 250px;border-style: none;padding: 3px;font-size:8pt;' type="text" id="logSearch" placeholder="Search" disabled>
        <select id="versionScope" style="float:right;width:120px;margin:8px;border:none;" name="logScope">
            <option value="thisversion">This Version</option>
            <option value="allversions">All Versions</option>
        </select>
    </div>
    <!--Log Table-->
    <div id="divLog" style="display:none;">
        <table style="min-width:800px;width:99.9%;border-collapse: collapse;" class='hover compact' id='logTable'>
            <thead><tr><th>Extranet Definition</th><th><span class="tableColumnVertLine">Filename</span></th><th><span class="tableColumnVertLine">Version</span></th><th><span class="tableColumnVertLine">Status</span></th><th><span class="tableColumnVertLine">Requested</span></th><th></th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
    <!--Info Panel-->
    <div id="divInfo" style="width:100%;text-align:center;margin-top:150px;">Please Wait...</div>
    <!-- Dashboard implementation -->
    <script type="text/javascript">
        "use strict";
        "use strict";
        var m_vault;
        var m_dashboard;
        var _jsonData;
        var m_startEventHandle;
        var m_stopEventHandle;

        function OnNewDashboard(dashboard) {
            /// <summary>Dashboard code entry point.</summary>
            /// <param name="dashboard" type="MFiles.Dashboard">The new dashboard object.</param>

            // Register a handler to listen the started event.
            m_startEventHandle = dashboard.Events.Register(Event_Started, getDashboardStartedHandler(dashboard));
            m_stopEventHandle = dashboard.Events.Register(Event_Stop, getDashboardStopHandler());
        }

        function getDashboardStartedHandler(dashboard) {
            /// <summary>Gets the event handler function for dashboard starting event.</summary>
            /// <param name="dashboard" type="MFiles.Dashboard">The current dashboard object.</param>
            /// <returns type="MFiles.Events.OnStarted">The event handler.</returns>

            // initialise member variables
            m_dashboard = dashboard;
            m_vault = m_dashboard.Vault;
            _jsonData = dashboard.CustomData;

            // Return the handler function.
            return function () {

                //initialise Vault GUID and Project ID globals
                vaultGUID = m_vault.getGUID();
                objectID = m_objectData.ObjectID;
                objectVer = m_objectData.Version;

                //update Project Header
                updateHeader(m_objectData);

                //populate Log Table
                getDocumentLogData();

                $('#versionScope').blur();
            };
        }

        function getDashboardStopHandler() {
            return function () {
                m_dashboard.Events.Unregister(m_startEventHandle);
                m_dashboard.Events.Unregister(m_stopEventHandle);
            };
        }

        // version scope change
        $('#versionScope').change(function () {
            getDocumentLogData(false);
        });

    </script>
</body>
</html>
